<h3>Crear Nueva Oferta</h3>

<form [formGroup]="ofertaForm" (ngSubmit)="onSubmit()">
  <div>
    <label for="nombre">Nombre *</label>
    <input 
      type="text" 
      id="nombre" 
      formControlName="nombre"
      placeholder="Nombre de la oferta"
    />
    <div *ngIf="getError('nombre')" class="error">{{ getError('nombre') }}</div>
  </div>

  <div>
    <label for="descripcion">Descripción</label>
    <textarea 
      id="descripcion" 
      formControlName="descripcion"
      placeholder="Descripción de la oferta"
      rows="3"
    ></textarea>
    <div *ngIf="getError('descripcion')" class="error">{{ getError('descripcion') }}</div>
  </div>

  <div>
    <label for="descuento">Descuento (%) *</label>
    <input 
      type="number" 
      id="descuento" 
      formControlName="descuento"
      placeholder="0-100"
      min="0"
      max="100"
    />
    <div *ngIf="getError('descuento')" class="error">{{ getError('descuento') }}</div>
  </div>

  <div>
    <label for="fechaInicio">Fecha de Inicio *</label>
    <input 
      type="datetime-local" 
      id="fechaInicio" 
      formControlName="fechaInicio"
    />
    <div *ngIf="getError('fechaInicio')" class="error">{{ getError('fechaInicio') }}</div>
  </div>

  <div>
    <label for="fechaFin">Fecha de Fin *</label>
    <input 
      type="datetime-local" 
      id="fechaFin" 
      formControlName="fechaFin"
    />
    <div *ngIf="getError('fechaFin')" class="error">{{ getError('fechaFin') }}</div>
  </div>

  <div>
    <label for="imagen">URL de Imagen</label>
    <input 
      type="url" 
      id="imagen" 
      formControlName="imagen"
      placeholder="https://ejemplo.com/imagen.jpg"
    />
  </div>

  <div>
    <label for="estado">Estado</label>
    <input 
      type="checkbox" 
      id="estado" 
      formControlName="estado"
    />
    <span>Activa</span>
  </div>

  <div>
    <label>Productos Aplicables</label>
    <div *ngIf="productos.length > 0" class="seleccion-multiple">
      <div *ngFor="let producto of productos" class="item-seleccionable">
        <input 
          type="checkbox" 
          [id]="'producto-' + producto._id"
          [checked]="isProductoSeleccionado(producto._id)"
          (change)="toggleProducto(producto._id)"
        />
        <label [for]="'producto-' + producto._id">
          {{ producto.nombre }} - ${{ producto.precio }}
        </label>
      </div>
    </div>
    <div *ngIf="productos.length === 0">
      <p>Cargando productos...</p>
    </div>
    <div *ngIf="productosSeleccionados.length > 0">
      <small>Seleccionados: {{ productosSeleccionados.length }} producto(s)</small>
    </div>
  </div>

  <div>
    <label>Categorías Aplicables</label>
    <div *ngIf="categorias.length > 0" class="seleccion-multiple">
      <div *ngFor="let categoria of categorias" class="item-seleccionable">
        <input 
          type="checkbox" 
          [id]="'categoria-' + categoria._id"
          [checked]="isCategoriaSeleccionada(categoria._id)"
          (change)="toggleCategoria(categoria._id || '')"
        />
        <label [for]="'categoria-' + categoria._id">
          {{ categoria.nombre }}
        </label>
      </div>
    </div>
    <div *ngIf="categorias.length === 0">
      <p>Cargando categorías...</p>
    </div>
    <div *ngIf="categoriasSeleccionadas.length > 0">
      <small>Seleccionadas: {{ categoriasSeleccionadas.length }} categoría(s)</small>
    </div>
  </div>

  <button type="submit" [disabled]="ofertaForm.invalid">Crear Oferta</button>
</form>

<div *ngIf="mensaje" class="mensaje-exito">{{ mensaje }}</div>
<div *ngIf="error" class="mensaje-error">{{ error }}</div>

<div>
  <h4>Debug - Estado del Formulario:</h4>
  <pre>{{ ofertaForm.value | json }}</pre>
  <pre>Válido: {{ ofertaForm.valid }}</pre>
  <pre>Errores: {{ ofertaForm.errors | json }}</pre>
  <pre>Productos seleccionados: {{ productosSeleccionados | json }}</pre>
  <pre>Categorías seleccionadas: {{ categoriasSeleccionadas | json }}</pre>
</div> 