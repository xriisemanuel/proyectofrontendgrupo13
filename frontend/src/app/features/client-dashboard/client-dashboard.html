<!-- src/app/components/client-dashboard/client-dashboard.html -->
<div class="client-dashboard-wrapper">
  <!-- Encabezado del Dashboard -->
  <header class="dashboard-header">
    <h1>Bienvenido, {{ usuario?.nombre || 'Cliente' }}!</h1>
    <button (click)="onLogout()" class="btn-logout">
      <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
    </button>
  </header>

  <p class="dashboard-intro">Aquí puedes gestionar tu cuenta, explorar productos y realizar tus pedidos fácilmente.</p>

  <!-- Mensajes de Carga y Error -->
  <div *ngIf="isLoading" class="loading-message">
    <i class="fas fa-spinner fa-spin"></i> Cargando tu información...
  </div>

  <div *ngIf="errorMessage && !isLoading" class="error-panel">
    <i class="fas fa-exclamation-triangle"></i>
    <p>{{ errorMessage }}</p>
    <p>Por favor, asegúrate de haber iniciado sesión con una cuenta de cliente.</p>
    <a [routerLink]="['/login']" class="btn-go-to-login">
      <i class="fas fa-sign-in-alt"></i> Ir a Iniciar Sesión
    </a>
  </div>

  <!-- Contenido Principal del Dashboard (Solo si no hay carga ni error y hay datos) -->
  <div *ngIf="!isLoading && !errorMessage && cliente && usuario" class="dashboard-content-grid">

    <!-- Sección de Tu Perfil -->
    <section class="profile-section">
      <h2 class="section-title">Tu Perfil</h2>
      <div class="profile-info-grid">
        <div class="info-item">
          <strong>Usuario:</strong> <span>{{ usuario.username }}</span>
        </div>
        <div class="info-item">
          <strong>Email:</strong> <span>{{ usuario.email }}</span>
        </div>
        <div class="info-item">
          <strong>Nombre Completo:</strong> <span>{{ usuario.nombre }} {{ usuario.apellido }}</span>
        </div>
        <div class="info-item">
          <strong>Teléfono:</strong> <span>{{ usuario.telefono || 'N/A' }}</span>
        </div>
        <div class="info-item">
          <strong>Dirección Principal:</strong> <span>{{ cliente.direccion || 'No especificada' }}</span>
        </div>
        <div class="info-item">
          <strong>Fecha Nacimiento:</strong> <span>{{ cliente.fechaNacimiento ? (cliente.fechaNacimiento | date:'dd/MM/yyyy') : 'No especificada' }}</span>
        </div>
        <div class="info-item">
          <strong>Preferencias Alimentarias:</strong> <span>{{ cliente.preferenciasAlimentarias?.length ? cliente.preferenciasAlimentarias?.join(', ') : 'Ninguna' }}</span>
        </div>
        <div class="info-item">
          <strong>Puntos de Lealtad:</strong> <span class="points-value">{{ cliente.puntos || 0 }}</span>
        </div>
      </div>
      <button class="btn-edit-profile" (click)="goToEditProfile()">
        <i class="fas fa-user-edit"></i> Editar Perfil
      </button>
    </section>

    <!-- Sección de Acciones Rápidas -->
    <section class="quick-actions-section">
      <h2 class="section-title">Acciones Rápidas</h2>
      <div class="action-cards-grid">
        <a (click)="goToMisPedidos()" class="action-card">
          <i class="fas fa-clipboard-list"></i>
          <h4>Mis Pedidos</h4>
          <p>Revisa el estado y el historial de tus pedidos.</p>
        </a>
        <a (click)="goToCalificaciones()" class="action-card">
          <i class="fas fa-star"></i>
          <h4>Calificar Pedidos</h4>
          <p>Comparte tu experiencia y califica tus pedidos.</p>
        </a>
        <a routerLink="/client/ofertas" class="action-card">
          <i class="fas fa-tags"></i>
          <h4>Ver Ofertas</h4>
          <p>Descubre las últimas promociones y descuentos.</p>
        </a>
        <a routerLink="/client/combos" class="action-card">
          <i class="fas fa-box-open"></i>
          <h4>Explorar Combos</h4>
          <p>Encuentra combinaciones especiales a mejor precio.</p>
        </a>
        <a routerLink="/client/products" class="action-card">
          <i class="fas fa-utensils"></i>
          <h4>Ver Productos</h4>
          <p>Explora todo nuestro catálogo de productos.</p>
        </a>
        <a routerLink="/client/categories" class="action-card">
          <i class="fas fa-folder-open"></i>
          <h4>Explorar Categorías</h4>
          <p>Navega por nuestras categorías de productos.</p>
        </a>
      </div>
    </section>

    <!-- Sección de Productos Destacados (si existen) -->
    <section *ngIf="products && products.length > 0" class="products-section">
      <h2 class="section-title">Productos Destacados</h2>
      <div class="products-grid">
        <div *ngFor="let product of products.slice(0, 4)" class="product-card">
          <img [src]="getProductImageUrl(product)" alt="{{ product.nombre }}" class="product-image">
          <div class="product-details">
            <h3 class="product-title">{{ product.nombre }}</h3>
            <p class="product-description">{{ product.descripcion | slice:0:70 }}...</p>
            <div class="product-price">{{ product.precio | currency:'USD':'symbol':'1.2-2' }}</div>
            <button class="btn-buy" (click)="comprarProducto(product)">
              <i class="fas fa-shopping-cart"></i> Comprar
            </button>
          </div>
        </div>
      </div>
      <div class="section-footer">
        <a routerLink="/client/products" class="btn-view-all">
          Ver Todos los Productos <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </section>

    <!-- Sección de Categorías (si existen) -->
    <section *ngIf="categories && categories.length > 0" class="categories-section">
      <h2 class="section-title">Explorar Categorías</h2>
      <div class="categories-grid">
        <a *ngFor="let category of categories.slice(0, 4)" [routerLink]="['/client/categories', category._id]" class="category-card">
          <img [src]="getCategoryImageUrl(category)" alt="{{ category.nombre }}" class="category-image">
          <div class="category-details">
            <h3 class="category-title">{{ category.nombre }}</h3>
            <p class="category-description">{{ category.descripcion | slice:0:50 }}...</p>
          </div>
        </a>
      </div>
      <div class="section-footer">
        <a routerLink="/client/categories" class="btn-view-all">
          Ver Todas las Categorías <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </section>

  </div>
</div>
