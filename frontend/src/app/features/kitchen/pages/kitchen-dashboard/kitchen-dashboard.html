<div class="kitchen-dashboard-container">
  <h2>Dashboard de Cocina</h2>
  <p>Gestión y seguimiento de pedidos para preparación.</p>

  <div class="filter-actions">
    <div class="filter-group">
      <label for="filterState">Filtrar por Estado:</label>
      <select id="filterState" [(ngModel)]="selectedFilterState" (change)="applyFilters()">
        <option value="">Todos los relevantes</option>
        <option value="pendiente">Pendiente</option>
        <option value="confirmado">Confirmado</option>
        <option value="en_preparacion">En Preparación</option>
        <option value="en_envio">En Envío (solo vista)</option>
        <option value="listo_para_entrega">Listo para Entrega</option>
        <option value="cancelado">Cancelado</option>
      </select>
    </div>

    <div class="filter-group search-group">
      <label for="searchTerm">Buscar:</label>
      <input type="text" id="searchTerm" [(ngModel)]="searchTerm" (input)="applyFilters()" placeholder="ID, cliente, producto...">
      <i class="fas fa-search search-icon"></i>
    </div>
  </div>

  <div *ngIf="successMessage" class="alert success-message">
    <i class="fas fa-check-circle"></i> {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert error-message">
    <i class="fas fa-exclamation-triangle"></i> {{ errorMessage }}
  </div>

  <div *ngIf="isLoading" class="loading-spinner">
    <i class="fas fa-spinner fa-spin"></i> Cargando pedidos...
  </div>

  <div *ngIf="!isLoading && filteredPedidos.length === 0 && !errorMessage" class="no-data-message">
    <i class="fas fa-info-circle"></i> No hay pedidos con los filtros aplicados.
  </div>

  <div *ngIf="!isLoading && filteredPedidos.length > 0" class="pedidos-table-container">
    <table class="pedidos-table">
      <thead>
        <tr>
          <th>ID Pedido</th>
          <th>Fecha</th>
          <th>Cliente</th>
          <th>Productos</th>
          <th>Total</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pedido of filteredPedidos">
          <td>{{ pedido._id }}</td>
          <td>{{ pedido.fechaPedido | date:'short' }}</td>
          <td>{{ getClienteNombre(pedido.clienteId) }}</td>
          <td>
            <ul>
              <li *ngFor="let item of pedido.detalleProductos">
                {{ item.cantidad }}x {{ item.nombreProducto }} (${{ item.precioUnitario | number:'1.2-2' }})
              </li>
            </ul>
          </td>
          <td>${{ pedido.total | number:'1.2-2' }}</td>
          <td>
            <span class="status-badge" [ngClass]="'status-' + pedido.estado">
              {{ pedido.estado | titlecase }}
            </span>
          </td>
          <td class="actions-cell">
            <button
              class="btn btn-action btn-change-status"
              (click)="updatePedidoEstado(pedido._id, pedido.estado)"
              [disabled]="!getAvailableNextStates(pedido.estado) || Object.keys(getAvailableNextStates(pedido.estado)).length === 0"
              title="Cambiar Estado"
            >
              <i class="fas fa-sync-alt"></i> Cambiar Estado
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>