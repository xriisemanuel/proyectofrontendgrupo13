<div class="manage-repartidores-container">
  <h2>Gestión de Repartidores</h2>
  <p>Lista de repartidores registrados en el sistema.</p>

  <div class="action-buttons">
    <!-- El botón para añadir repartidor lleva al formulario de creación adaptable -->
    <a routerLink="/admin/users/create" class="btn btn-primary">
      <i class="fas fa-user-plus"></i> Añadir Nuevo Repartidor
    </a>
    <button (click)="loadRepartidores()" class="btn btn-secondary">
      <i class="fas fa-sync-alt"></i> Actualizar Lista
    </button>
  </div>

  <div *ngIf="isLoading" class="loading-spinner">
    <i class="fas fa-spinner fa-spin"></i> Cargando repartidores...
  </div>

  <div *ngIf="errorMessage" class="error-message">
    <i class="fas fa-exclamation-triangle"></i> {{ errorMessage }}
  </div>

  <div *ngIf="!isLoading && repartidores.length === 0 && !errorMessage" class="no-data-message">
    <i class="fas fa-info-circle"></i> No hay repartidores registrados en el sistema.
  </div>

  <div *ngIf="!isLoading && repartidores.length > 0" class="table-responsive">
    <table>
      <thead>
        <tr>
          <th>Username</th>
          <th>Nombre Completo</th>
          <th>Email</th>
          <th>Teléfono</th>
          <th>Estado Usuario</th>
          <th>Estado Repartidor</th>
          <th>Vehículo</th>
          <th>Licencia</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let repartidor of repartidores">
          <td>{{ repartidor.username }}</td>
          <td>{{ repartidor.nombre }} {{ repartidor.apellido }}</td>
          <td>{{ repartidor.email }}</td>
          <td>{{ repartidor.telefono || 'N/A' }}</td>
          <td>
            <span [class.active-status]="repartidor.estado" [class.inactive-status]="!repartidor.estado">
              {{ repartidor.estado ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
          <!-- Accede a las propiedades del perfil de repartidor a través de repartidor.repartidorId -->
          <td>{{ repartidor.repartidorId?.estado || 'N/A' }}</td>
          <td>{{ repartidor.repartidorId?.vehiculo || 'N/A' }}</td>
          <td>{{ repartidor.repartidorId?.numeroLicencia || 'N/A' }}</td>
          <td class="action-cell">
            <button (click)="editRepartidor(repartidor._id)" class="btn btn-edit" title="Editar">
              <i class="fas fa-edit"></i>Editar
            </button>
            <button (click)="deleteRepartidor(repartidor._id, repartidor.username)" class="btn btn-delete"
              title="Eliminar">
              <i class="fas fa-trash-alt"></i>Eliminar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="back-link">
    <a routerLink="/admin/users/manage-by-role"><i class="fas fa-arrow-left"></i> Volver a Gestión por Rol</a>
  </div>
</div>