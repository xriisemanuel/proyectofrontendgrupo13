<div class="container mt-4">
  <h2>Productos disponibles - SUBTE</h2>

  <!-- Botón para agregar nuevo producto -->
  <div class="d-flex justify-content-end mb-3">
    <button class="btn btn-success" (click)="irAFormulario()">Agregar producto</button>
  </div>

  <!-- Buscador reactivo -->
  <div class="input-group mb-4">
    <input type="text"
           [(ngModel)]="busqueda"
           (ngModelChange)="filtrarProductos()"
           placeholder="Buscar producto..."
           class="form-control">
    <span class="input-group-text"><i class="bi bi-search"></i></span>
  </div>

  <!-- Resultado filtrado o completo -->
  <div *ngIf="(busqueda ? productosFiltrados.length : productos.length) > 0; else sinProductos">
    <div class="row">
      <div class="col-md-4 mb-4"
           *ngFor="let producto of (busqueda ? productosFiltrados : productos)">
        <div class="card h-100 shadow">
          <!-- Imagen principal (opcionalmente más imágenes debajo) -->
          <img [src]="producto.imagenes[0]" class="card-img-top" alt="{{ producto.nombre }}"
               style="height: 200px; object-fit: cover;">

          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ producto.nombre }}</h5>
            <p class="card-text">{{ producto.descripcion }}</p>
            <p><strong>Precio:</strong> ${{ producto.precio }}</p>
            <p><strong>Stock:</strong> {{ producto.stock }}</p>
            <p><strong>Popularidad:</strong> {{ producto.popularidad }}</p>
           <p><strong>Categoría:</strong> {{ producto.categoriaId?.nombre }}</p>
            <p>
              <strong>Disponible:</strong>
              <span class="badge" [ngClass]="producto.disponible ? 'bg-success' : 'bg-danger'">
                {{ producto.disponible ? 'Sí' : 'No' }}
              </span>
            </p>

            <div class="mt-auto d-flex justify-content-between">
              <button class="btn btn-primary btn-sm" (click)="editarProducto(producto)">Modificar</button>
              <button class="btn btn-danger btn-sm" (click)="eliminarProducto(producto._id)">Eliminar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sin productos -->
  <ng-template #sinProductos>
    <p class="text-muted">No se encontraron productos disponibles.</p>
  </ng-template>

  <!-- Modal de éxito -->
  <div class="modal fade" id="modalExito" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">¡Éxito!</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <p>{{ mensajeModal }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
