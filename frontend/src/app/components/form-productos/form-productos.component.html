<div class="container mt-4">
  <h3>{{ modoEdicion ? 'Editar Producto' : 'Crear Nuevo Producto' }}</h3>

  <form #form="ngForm" (ngSubmit)="guardar()" class="mt-3">
    <!-- Nombre -->
    <div class="mb-3">
      <label class="form-label">Nombre</label>
      <input type="text"
             [(ngModel)]="producto.nombre"
             name="nombre"
             required
             #nombre="ngModel"
             [class.is-invalid]="form.submitted && nombre.invalid"
             class="form-control">
      <div *ngIf="form.submitted && nombre.invalid" class="invalid-feedback">
        El nombre es obligatorio.
      </div>
    </div>

    <!-- Descripción -->
    <div class="mb-3">
      <label class="form-label">Descripción</label>
      <textarea [(ngModel)]="producto.descripcion"
                name="descripcion"
                required
                #descripcion="ngModel"
                [class.is-invalid]="form.submitted && descripcion.invalid"
                class="form-control"></textarea>
      <div *ngIf="form.submitted && descripcion.invalid" class="invalid-feedback">
        La descripción es obligatoria.
      </div>
    </div>

    <!-- Imagen -->
    <div class="mb-3">
      <label class="form-label">URL de imagen</label>
      <input type="text"
             [(ngModel)]="producto.imagen"
             name="imagen"
             required
             #imagen="ngModel"
             [class.is-invalid]="form.submitted && imagen.invalid"
             class="form-control">
      <div *ngIf="form.submitted && imagen.invalid" class="invalid-feedback">
        La imagen es obligatoria.
      </div>
    </div>

    <!-- Precio -->
    <div class="mb-3">
      <label class="form-label">Precio</label>
      <input type="number"
             [(ngModel)]="producto.precio"
             name="precio"
             required
             min="1"
             #precio="ngModel"
             [class.is-invalid]="form.submitted && precio.invalid"
             class="form-control">
      <div *ngIf="form.submitted && precio.invalid" class="invalid-feedback">
        El precio debe ser mayor a $1.
      </div>
    </div>

    <!-- Estado -->
    <div class="mb-3">
      <label class="form-label">Estado</label>
      <select [(ngModel)]="producto.estado" name="estado" class="form-select">
        <option [value]="true">Activo</option>
        <option [value]="false">Inactivo</option>
      </select>
    </div>

    <!-- Categoría -->
    <div class="mb-3">
      <label class="form-label">Categoría</label>
      <select [(ngModel)]="producto.categoria" name="categoria" required #categoria="ngModel"
              [class.is-invalid]="form.submitted && categoria.invalid" class="form-select">
        <option *ngFor="let cat of categorias" [value]="cat._id">{{ cat.nombre }}</option>
      </select>
      <div *ngIf="form.submitted && categoria.invalid" class="invalid-feedback">
        Seleccioná una categoría.
      </div>
    </div>

    <!-- Botón Guardar -->
    <button type="submit" class="btn btn-primary" [disabled]="form.invalid">
      {{ modoEdicion ? 'Actualizar' : 'Guardar' }}
    </button>
  </form>

  <!-- Modal de éxito -->
  <div class="modal fade" id="modalExito" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">¡Éxito!</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <p>{{ mensajeModal }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
